{% extends "base.html" %}

{% load static from staticfiles %}

{% block title %}Lista de incidencias{% endblock %}

{% block extraCSS %}
    <link href="{% static "css/historial.css" %}" rel="stylesheet"  />
{% endblock %}

{% block content %}
    <h1 id="titulo"> Lista de Incidencias</h1>
    <div class="tabbable container">
        <ul class="nav nav-tabs" id="myTabs">
            {% if estados_all %}
                {% for est in estados_all %}
                    {% if forloop.first %}
                        <li href="#{{ est.id }}" class="active"><a>{{ est.nombre }}</a></li>
                    {% else %}
                        <li href="#{{ est.id }}" ><a>{{ est.nombre }}</a></li>
                    {% endif %}
                {% endfor %}
            {% else %}
                <li>No se han creado estados</li>
            {% endif %}
        </ul>

        <select class="form-control combo">
            {% if categorias_all %}
                {% for cat in categorias_all %}
                    <option value="{{ cat.id }}">{{ cat.nombre }}</option>
                {% endfor %}
            {% else %}
                <option value="1">No hay categorias a ense√±ar</option>
            {% endif %}
        </select>

        <div id="datos"></div>
    </div>
{% endblock %}

{% block extraScripts %}
    <!-- script type="text/javascript" src="{% static "js/jquery.js" %}"></script -->
    <script>
        $(function() {
            $('#myTabs').bind('show', function(e) {
               var pattern=/#.+/gi //use regex to get anchor(==selector)
               var contentID = e.target.toString().match(pattern)[0]; //get anchor
               //load content for selected tab
                $(contentID).load(baseURL+contentID.replace('#',''), function(){
                    $('#myTabs').tab(); //reinitialize tabs
                });
            });
        });
    </script>
    <script>
        $('select').on('change',inicio);
        function inicio(){
            var id_cat = $(this).val();
            $.getJSON('/filtro_ajax/', {'id_cat':id_cat},
            function(data){
                $.each(data, function(index, item){
                    div = '<div class="tab-content">'+
                                '<div class="tab-pane active" id="enReparacion">'+
                                    '<div class="panel panel-danger">'+
                                        '<div class"panel-heading">'+
                                            '<p>'+'ID de a incidencia: '+item.fields.incidencia+'</p>'+
                                        '</div>'+
                                        '<div class="panel-body">'+
                                            '<img id="thumbnail" src="{{ MEDIA_URL }}incidencias/imagen01.jpg" />'+
                                            '<div id="informacion">'+
                                                '<h4>'+'Informacion'+'</h4>'+
                                                '<p>'+'Fecha de la Incidencia: '+item.fields.fecha+'</p>'+
                                                '<p>'+'Comentario del Usuario: '+item.fields.comentario+'</p>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>'+
                                '</div>'+
                            '</div>';
                    $('#datos').append(div);
                });
            });
        }
    </script>
{% endblock %}